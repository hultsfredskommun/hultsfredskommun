rspkr.HL=function(){var b="",c={firstRun:0,previousWord:{},previousSent:{},lastWord:null,selectionRange:null,selectionHTML:null,selectedWordsRange:[]},g={oldWordHL:[],oldWordHLClass:[],oldSentHL:[],oldSentHLClass:[],sync:function(a,d){var b=!1,c=document.getElementById("sync"+d);0==(a&2)&&(b=0!=(a&1)?!0:!1);if(c&&c.className.replace("word","")!=c.className){if(!b&&0<this.oldWordHL.length){for(b=0;b<this.oldWordHLClass.length;b++)this.oldWordHL[b].className=this.oldWordHLClass[b];this.oldWordHL=[];
this.oldWordHLClass=[]}this.oldWordHLClass.push(c.className);this.oldWordHL.push(c);c.className="sync_word_highlighted"}else if(c&&c.className.replace("sent","")!=c.className){if(!b&&0<this.oldSentHL.length){for(b=0;b<this.oldSentHL.length;b++)this.oldSentHL[b].className=this.oldSentHLClass[b];this.oldSentHL=[];this.oldSentHLClass=[]}this.oldSentHLClass.push(c.className);this.oldSentHL.push(c);c.className="sync_sent_highlighted"}c&&rspkr.HL.Scroll.execScroll(c)},preProcess:{setRestoreContent:function(){rspkr.log("[Servermarkup.preProcess.setRestoreContent] Called!");
var a=rspkr.Common.data.getParam("readid"),a=document.getElementById(a).innerHTML;rspkr.Common.data.setRestoreContent(a)}},postProcess:{fullCleanUp:function(){rspkr.log("[Servermarkup.postProcess.fullCleanUp] Called!");rspkr.HL.Restore.all()},lightCleanUp:function(){rspkr.log("[Servermarkup.postProcess.lightCleanUp] Called!");var a=rspkr.HL.serverMarkup.oldWordHL,d=rspkr.HL.serverMarkup.oldWordHLClass,c=rspkr.HL.serverMarkup.oldSentHL,b=rspkr.HL.serverMarkup.oldSentHLClass;if(0<a.length){for(var f=
0;f<a.length;f++)a[f].className=d[f];rspkr.HL.serverMarkup.oldWordHL=[];rspkr.HL.serverMarkup.oldWordHLClass=[]}if(0<c.length){for(f=0;f<c.length;f++)c[f].className=b[f];rspkr.HL.serverMarkup.oldSentHL=[];rspkr.HL.serverMarkup.oldSentHLClass=[]}a=document.getElementsByTagName(rspkr.Common.data.browser.syncContainer);for(f=a.length-1;-1<f;f--)a[f].className=a[f].className.replace("sync_sent_highlighted","sync_sent"),a[f].className=a[f].className.replace("sync_word_highlighted","sync_word"),-1!==a[f].className.toLowerCase().indexOf("sync_user")&&
(a[f].className=a[f].className.replace("sync_sent",""),a[f].className=a[f].className.replace("sync_word",""),a[f].removeAttribute("id"))}}},e={enums:{key:"readspeaker_inline_styles",sent:"sync_sent",sent_hl:"sync_sent_highlighted",word:"sync_word",word_hl:"sync_word_highlighted"},word_index:null,sent_index:null,hlChanged:!1,setHL:function(){var a=rspkr.pub.Config,d=rspkr.Common.Settings.get("hlword")||a.item("settings.hlword"),a=rspkr.Common.Settings.get("hlsent")||a.item("settings.hlsent");this.updateHL("hlword",
d,null);this.updateHL("hlsent",a,null)},updateHL:function(a,d,e){rspkr.log(a+", "+d+", "+e,5);"hlspeed"===a&&d!==e&&(this.hlChanged=!0);if(d!==e&&("hl"===a||"hltoggle"===a))this.hlChanged=!0,rspkr.HL.sync.lightCleanUp();if(d!==e&&("hl"===a&&"none"!==d||"hltoggle"===a&&"hlon"===d))this.setTextStyle("word",rspkr.Common.Settings.get("hlword")),this.setTextStyle("sent",rspkr.Common.Settings.get("hlsent")),this.hlChanged=!0,rspkr.HL.Type.CURRENT===rspkr.HL.Type.CLIENT_MARKUP&&rspkr.PlayerAPI.releaseAdapter();
/hlword|hlsent|hlscroll/i.test(a)&&d!=e&&("hlscroll"==a?rspkr.HL.Scroll.initScroll():(this.setTextStyle(a,d),"explorer"==b&&(c.selectionRange&&("wordsent"===rspkr.st.get("hl")&&"hlsent"==a)&&(c.selectionRange.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")),c.selectionRange.execCommand("forecolor",0,rspkr.cfg.item("settings.hltext"))),c.lastWord&&("sent"==rspkr.st.get("hl")?c.lastWord.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")):c.lastWord.execCommand("backcolor",0,
rspkr.Common.Settings.get("hlword")),c.lastWord.execCommand("forecolor",0,rspkr.cfg.item("settings.hltext"))))))},setTextStyle:function(a,d,c){var b=/word/.test(a)?"word":"sent",a="background-color",c=c||e.enums.key;/underline/.test(d)?(a="text-decoration",d+=" !important; color: none !important; background-color: none !important"):/none/.test(d)?(a="background",d+=" !important; text-decoration: none !important; background-color: none !important"):d+=" !important; text-decoration: none !important";
rspkr.Common.css.replaceRule(c,"."+e.enums[b+"_hl"],a+": "+d+"")}};return{meta:{revision:"1618"},init:function(){var a=rspkr.Common.addEvent;a("onAfterModsLoaded",function(){a("onAPIInitAdapter",rspkr.HL.Restore.setRestoreContent);rspkr.HL.addEvents();rspkr.HL.Scroll.initScroll();b=document.selection&&9>rspkr.Common.data.browser.version?"explorer":"gecko";rspkr.log("[rspkr.hl] Using engine "+b);var d=rspkr.HL.engine[b].clientExtension,e;for(e in d)c[e]=d[e];window.addEventListener&&window.addEventListener("message",
rspkr.HL.html5.receiveMessage,!1,!0)});a("onModsLoaded",{func:e.setHL,context:e});a("onSettingsChanged",{func:e.updateHL,context:e});rspkr.log("[rspkr.HL] Initialized!")},addEvents:function(){rspkr.log("[rspkr.HL.addEvents]");evt("onUIClosePlayer",rspkr.HL.cleanUpHandler);evt("onUIClosePlayer",function(){rspkr.hl.State.setState(rspkr.hl.State.READY)});evt("onUIStop",function(){rspkr.hl.State.setState(rspkr.hl.State.STOPPED)});evt("onUIBeforePlay",function(){rspkr.hl.Restore.checkContent()});rspkr.PlayerAPI&&
(rspkr.PlayerAPI.adapter&&"html5"===rspkr.PlayerAPI.adapter)&&(rspkr.evt("onAPIInitAdapter",rspkr.HL.html5.handlers.init),rspkr.evt("onAPIPlay",rspkr.HL.html5.handlers.play),rspkr.evt("onAPIPause",rspkr.HL.html5.handlers.pause),rspkr.evt("onAPIStop",rspkr.HL.html5.handlers.stop),rspkr.evt("onAPIRewind",rspkr.HL.html5.handlers.updateTime),rspkr.evt("onAPISetProgress",rspkr.HL.html5.handlers.updateTime),rspkr.evt("onAPIReleaseAdapter",rspkr.HL.html5.handlers.release));rspkr.evt("onAPIStop",rspkr.HL.sync.lightCleanUp)},
cleanUpHandler:function(a){rspkr.log("[rspkr.HL.cleanUpHandler] String is: "+a);"userclick"===a||"nosel"===a?rspkr.HL.sync.fullCleanUp():rspkr.HL.sync.lightCleanUp()},clientMarkup:c,serverMarkup:g,markedUpHTML:"",html5:{States:{BEGIN:0,STOPPED:1,USER_START_NOT_READY:2,USER_START_PLAYING:3,NOT_PLAYING:4,CURRENT:0,setState:function(a){this.CURRENT=a;rspkr.log("[rspkr.hl.html5.States.setState] Changing state from "+this.CURRENT+" to "+a,1)}},Events:{canPlay:!1,durationChange:!1,syncReady:!1,eventTimer:null,
onCanPlay:function(){rspkr.log("onCanPlay fired!",1);this.canPlay=!0;this.checkCompletion()},checkCompletion:function(){this.canPlay&&(this.durationChange&&this.syncReady)&&(clearTimeout(this.eventTimer),this.eventTimer=null,rspkr.hl.html5.Events.resetAll(),rspkr.hl.html5.refresh())},onDurationChange:function(){rspkr.log("onDurationChange fired!",1);this.durationChange=!0;this.checkCompletion()},onSyncReady:function(){rspkr.log("onSyncReady fired!",1);this.syncReady=!0;this.checkCompletion();this.eventTimer=
setTimeout(function(){rspkr.log("[rspkr.hl.html5.Events] Timer triggered. Starting playback.",1);rspkr.hl.html5.Events.resetAll();rspkr.hl.html5.refresh()},2500)},resetAll:function(){this.syncReady=this.durationChange=this.canPlay=!1}},lastcurrenttime:-1,currentsyncindex:0,lastevent:null,lastlastevent:null,lastlastlastevent:null,synclist:[],synclistindex:0,audioUrl:null,backupUrl:null,frameUrl:null,timer:null,postMessageData:[],runningRefresh:!1,handlers:{init:function(){rspkr.log("[rspkr.HL.html5.handlers.init]");
var a=Math.random(),d={};d.audioformat=rspkr.Common.data.browser.html5AudioFormat;d.requestgrouptype="html5iframe";d.requestgroup=a;rspkr.HL.html5.backupUrl=rspkr.Common.data.getAudioLink(d);(!0===rspkr.cfg.item("general.usePost")||0<rspkr.Common.data.selectedText.length||0<rspkr.Common.data.selectedHTML.length)&&"iOS"!==rspkr.Common.data.browser.OS&&"Android"!==rspkr.Common.data.browser.OS?rspkr.HL.html5.timer=setTimeout(function(){rspkr.HL.html5.initSyncFrame(d);rspkr.HL.html5.initAudio();clearTimeout(rspkr.HL.html5.timer)},
2E3):(rspkr.log("Normal audio init!"),rspkr.HL.html5.initSyncFrame(d),rspkr.HL.html5.initAudio())},play:function(){rspkr.log("[rspkr.HL.html5.handlers.play]");rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP&&rspkr.hl.html5.States.CURRENT==rspkr.hl.html5.States.STOPPED?(rspkr.hl.html5.States.setState(rspkr.hl.html5.States.BEGIN),rspkr.PlayerAPI.playerRef.pause(),rspkr.HL.html5.handlers.runPostMessages()):rspkr.HL.Type.CURRENT==rspkr.HL.Type.SERVER_MARKUP&&rspkr.hl.html5.States.CURRENT==rspkr.hl.html5.States.STOPPED?
rspkr.hl.State.setState(rspkr.hl.State.RELOAD)?this.init():(rspkr.hl.html5.States.setState(rspkr.hl.html5.States.BEGIN),rspkr.PlayerAPI.playerRef.pause(),rspkr.HL.html5.handlers.runPostMessages()):(rspkr.hl.html5.States.CURRENT=rspkr.hl.html5.States.USER_START_PLAYING,rspkr.hl.html5.refresh())},pause:function(){rspkr.hl.html5.States.setState(rspkr.hl.html5.States.NOT_PLAYING);rspkr.hl.html5.lastcurrenttime=0},release:function(){rspkr.log("[rspkr.HL.html5.handlers.release]");rspkr.HL.html5.synclist=
[];rspkr.HL.html5.synclistindex=0;rspkr.HL.html5.currentsyncindex=0;rspkr.HL.html5.lastcurrenttime=-1;rspkr.HL.html5.audioUrl=null;rspkr.HL.html5.backupUrl=null;rspkr.HL.html5.frameUrl=null;rspkr.HL.html5.postMessageData=[];rspkr.HL.html5.Events.resetAll();rspkr.PlayerAPI.playerRef.removeEventListener("ended",rshlexit,!1);rspkr.PlayerAPI.playerRef=null;var a=document.getElementById("ReadSpeaker_sync_iframe");a&&(a.src="about:blank")},stop:function(){rspkr.hl.html5.States.setState(rspkr.hl.html5.States.STOPPED);
rspkr.HL.html5.lastcurrenttime=-1;rspkr.HL.html5.currentsyncindex=0},updateTime:function(){rspkr.log("[rspkr.HL.html5.handlers.updateTime]");rspkr.hl.html5.States.setState(rspkr.hl.html5.States.NOT_PLAYING);rspkr.HL.html5.lastcurrenttime=rspkr.PlayerAPI.playerRef.currentTime;rspkr.HL.html5.currentsyncindex=0;rspkr.HL.html5.handlers.setCurrentSyncIndex();rspkr.hl.html5.States.setState(rspkr.hl.html5.States.USER_START_PLAYING)},runPostMessages:function(){rspkr.log("[rspkr.HL.html5.handlers.runPostMessages]");
var a=rspkr.HL.html5.postMessageData,d;for(d in a)null!==a[d-1]&&"rshlsetContent"==a[d]?rspkr.HL.sync.setContent(rspkr.Common.base64.decode(a[d-1])):null!==a[d-1]&&"rshlsetId"==a[d]?rspkr.HL.sync.setId(a[d-1]):"rshlinit"==a[d]&&(rspkr.HL.sync.init(),rspkr.PlayerAPI.playerRef.play(),rspkr.HL.html5.refresh())},setCurrentSyncIndex:function(){if(0<rspkr.HL.html5.synclist.length&&rspkr.HL.html5.synclist[rspkr.HL.html5.currentsyncindex])for(;20>=1*rspkr.HL.html5.synclist[rspkr.HL.html5.currentsyncindex][0]-
1E3*rspkr.PlayerAPI.playerRef.currentTime;)rspkr.HL.html5.currentsyncindex++},totalTime:function(){var a=rspkr.PlayerAPI.playerRef;if(a)if("Opera"!==rspkr.Common.data.browser.name&&a.buffered&&a.buffered.end)try{return 0<a.buffered.length?a.buffered.end(a.buffered.length-1):a.buffered.end(0)}catch(d){return a.duration&&"infinity"!==a.duration.toString().toLowerCase()&&"NaN"!==a.duration?a.duration:a.currentTime+15}else return a.duration&&"infinity"!==a.duration.toString.toLowerCase()&&"NaN"!==a.duration?
a.duration:a.currentTime+15}},initAudio:function(){rspkr.HL.html5.audioUrl||(rspkr.HL.html5.audioUrl=rspkr.HL.html5.backupUrl);rspkr.log("[rspkr.html5.initAudio] Audio URL: "+rspkr.HL.html5.audioUrl,1);rspkr.PlayerAPI.playerRef=new Audio(rspkr.HL.html5.audioUrl);var a=rspkr.PlayerAPI.playerRef;a.loop=!1;a.preload="auto";a.volume=parseFloat((rspkr.st.get("hlvol")||100)/100);rspkr.devt("onVolumeAdjusted",window);rspkr.PlayerAPI.playerRef.play();rspkr.PlayerAPI.playerRef.pause();a.addEventListener("canplay",
function(){rspkr.hl.html5.Events.onCanPlay()},!1);a.addEventListener("durationchange",function(){rspkr.log("[rspkr.hl.html5.initAudio] Durationchange occurred",1);1==rspkr.HL.html5.handlers.totalTime()&&!0==rspkr.PlayerAPI.playerRef.paused?rspkr.HL.html5.initAudio():(0===rspkr.HL.html5.handlers.totalTime()&&rspkr.pl.playerRef.play(),rspkr.hl.html5.Events.onDurationChange(),rspkr.PlayerAPI.playerRef.addEventListener("ended",function(){window.rshlexit("false")},!1))},!1);rspkr.pl.checkNetworkStatus();
rspkr.hl.html5.States.setState(rspkr.hl.html5.States.BEGIN)},initSyncFrame:function(a){if("none"!=rspkr.Common.data.sync){var d=null;document.getElementById("ReadSpeaker_sync_iframe")?d=document.getElementById("ReadSpeaker_sync_iframe"):(d=document.createElement("iframe"),d.setAttribute("id","ReadSpeaker_sync_iframe"));!rspkr.HL.html5.frameUrl&&(!0===rspkr.cfg.item("general.usePost")||0<rspkr.Common.data.selectedText.length||0<rspkr.Common.data.selectedHTML.length)?rspkr.HL.html5.frameUrl=rspkr.HL.html5.backupUrl+
"sync":rspkr.HL.html5.frameUrl||(a.audioformat="html5iframe",rspkr.HL.html5.frameUrl=rspkr.Common.data.getAudioLink(a));rspkr.log("[rspkr.HL.html5.initSyncFrame] Audio URL: "+rspkr.HL.html5.frameUrl);d.src=rspkr.HL.html5.frameUrl;d.type="text/javascript";d.height=0;d.width=0;d.style.display="none";document.body.appendChild(d)}else rspkr.hl.html5.States.setState(rspkr.hl.html5.States.USER_START_PLAYING),rspkr.PlayerAPI.playerRef.play()},receiveMessage:function(a){a.origin.match(/readspeaker.?.com/gi)&&
(rspkr.HL.html5.postMessageData.push(a.data),!/android|ios/i.test(rspkr.Common.data.browser.OS)&&"rshlfinished"==a.data&&(rspkr.HL.html5.timer&&clearTimeout(rspkr.HL.html5.timer),rspkr.HL.html5.initSyncFrame(),rspkr.HL.html5.initAudio()),-1!=a.data.indexOf("."+rspkr.Common.data.browser.html5AudioFormat)?rspkr.HL.html5.audioUrl=a.data:-1!=a.data.indexOf(".html5iframe")?rspkr.HL.html5.frameUrl=a.data:"rshlaudio"!=a.data&&"rshlhtml5sync"!=a.data&&(null!=rspkr.HL.html5.lastevent&&"rshlsetContent"==a.data?
(rspkr.HL.html5.synclist=[],rspkr.HL.html5.synclistindex=0,rspkr.HL.sync.setContent(rspkr.Common.base64.decode(rspkr.HL.html5.lastevent.data))):null!=rspkr.HL.html5.lastevent&&"rshlsetId"==a.data?rspkr.HL.sync.setId(rspkr.HL.html5.lastevent.data):"rshlinit"==a.data?(rspkr.HL.sync.init(),rspkr.hl.html5.Events.onSyncReady()):null!=rspkr.HL.html5.lastlastlastevent&&(null!=rspkr.HL.html5.lastlastevent&&null!=rspkr.HL.html5.lastevent&&"rshlsync"==a.data)&&(rspkr.HL.html5.synclist[rspkr.HL.html5.synclistindex]=
[rspkr.HL.html5.lastlastlastevent.data,rspkr.HL.html5.lastlastevent.data,rspkr.HL.html5.lastevent.data],rspkr.HL.html5.synclistindex++),rspkr.HL.html5.lastlastlastevent=rspkr.HL.html5.lastlastevent,rspkr.HL.html5.lastlastevent=rspkr.HL.html5.lastevent,rspkr.HL.html5.lastevent=a))},refresh:function(){var a=rspkr.PlayerAPI.playerRef,d=rspkr.HL.html5;!a||d.States.CURRENT==d.States.STOPPED?(rspkr.log("[rspkr.hl.html5.refresh] Audio is undefined or player is stopped",2),d.runningRefresh=!1):(d.States.CURRENT==
d.States.NOT_PLAYING&&setTimeout(function(){d.refresh()},500),0<a.currentTime&&parseInt(d.lastcurrenttime)>parseInt(a.currentTime)?(rspkr.log("[rspkr.hl.html5.refresh] An error has occured. Player is stopped.",2),rspkr.ui.getActivePlayer().stop(),d.runningRefresh=!1):(d.lastcurrenttime=a.currentTime,d.runningRefresh=!0,d.States.CURRENT==d.States.BEGIN?(rspkr.hl.html5.States.setState(d.States.USER_START_NOT_READY),setTimeout(function(){d.refresh()},200)):d.States.CURRENT==d.States.USER_START_NOT_READY?
d.synclist[d.currentsyncindex]&&1<d.handlers.totalTime()&&d.synclist[d.currentsyncindex][0]<1E3*d.handlers.totalTime()?(rspkr.hl.html5.States.setState(d.States.USER_START_PLAYING),a.play(),setTimeout(function(){d.refresh()},50)):0===d.handlers.totalTime()?(a.play(),setTimeout(function(){d.refresh()},250)):d.synclist[d.currentsyncindex]?20>=1*d.synclist[d.currentsyncindex][0]-1E3*a.currentTime?setTimeout(function(){d.refresh()},0):(a=1*d.synclist[d.currentsyncindex][0]-1E3*a.currentTime-20,75<a?setTimeout(function(){d.refresh()},
75):0>a?setTimeout(function(){d.refresh()},0):setTimeout(function(){d.refresh()},a)):setTimeout(function(){d.refresh()},75):d.States.CURRENT==d.States.USER_START_PLAYING&&(d.synclist[d.currentsyncindex]&&1*d.synclist[d.currentsyncindex][0]-20<1E3*a.currentTime&&(rspkr.HL.sync.execute(d.synclist[d.currentsyncindex][1],d.synclist[d.currentsyncindex][2]),d.currentsyncindex++),d.synclist[d.currentsyncindex]?20>=1*d.synclist[d.currentsyncindex][0]-1E3*a.currentTime?setTimeout(function(){d.refresh()},0):
(a=1*d.synclist[d.currentsyncindex][0]-1E3*a.currentTime-20,75<a?setTimeout(function(){d.refresh()},75):0>a?setTimeout(function(){d.refresh()},0):setTimeout(function(){d.refresh()},a)):setTimeout(function(){d.refresh()},75))))}},Preserve:{cls:"rs_preserve",testElem:null,elementShelter:[],formShelter:[],formData:function(a,d,c,b,f){this.name=a;this.type=d;this.value=c;this.checked=b;this.selectedIndex=f;this.selectedOptions=[]},moveToShelter:function(a){rspkr.log("[rspkr.HL.Preserve.moveToShelter]");
var d=[],c=[],b=null,f;(f=$rs.findIn(a,"."+rspkr.HL.Preserve.cls))&&!$rs.isArray(f)&&(f=[f]);for(var e=0,g=f.length;e<g;e++)b=$rs.get(f[e]).cloneNode(!1),f[e].parentNode.insertBefore(b,f[e]),d.push($rs.detach(f[e]));rspkr.log("[rspkr.hl.Preserve] Moved "+e+" nodes to the shelter.");a=$rs.findIn(a,"input, select");for(e=0;e<a.length;e++){b=new rspkr.HL.Preserve.formData(a[e].name,a[e].type,a[e].value,a[e].checked,a[e].selectedIndex);if("select-multiple"==a[e].type){f=a[e].options;for(var g=[],q=0;q<
f.length;q++)g.push(f[q].selected);b.selectedOptions=g}c.push(b)}rspkr.HL.Preserve.elementShelter.push(d);rspkr.HL.Preserve.formShelter.push(c)},restoreFromShelter:function(a){var d,c,b;rspkr.log("[rspkr.HL.Preserve.restoreFromShelter]");if(rspkr.HL.Preserve.elementShelter.length&&(b=rspkr.HL.Preserve.elementShelter.shift(),b.length)){(d=$rs.findIn(a,"."+rspkr.HL.Preserve.cls))&&!$rs.isArray(d)&&(d=[d]);for(var f=0,e=d.length;f<e;f++)c=b.shift(),d[f].parentNode.insertBefore(c,d[f]),d[f].parentNode.removeChild(d[f])}if(rspkr.HL.Preserve.formShelter.length&&
(a=$rs.findIn(a,"input, select"),d=rspkr.HL.Preserve.formShelter.shift(),a.length&&d.length&&a.length===d.length))for(f=0;f<a.length;f++)if(a[f].name===d[f].name)switch(a[f].type){case "text":a[f].value=d[f].value;break;case "password":a[f].value=d[f].value;break;case "radio":!0===d[f].checked&&(a[f].checked=!0);break;case "checkbox":a[f].checked=d[f].checked;break;case "select-one":a[f].selectedIndex=d[f].selectedIndex;break;case "select-multiple":c=a[f].options;for(b=0;b<c.length;b++)c[b].selected=
d[f].selectedOptions[b]}},clearShelter:function(){rspkr.log("[rspkr.HL.Preserve.clearShelter]");rspkr.HL.Preserve.elementShelter=[];rspkr.HL.Preserve.formShelter=[]}},Restore:{Storage:{readClass:[],readId:[],restoreContent:[]},all:function(){rspkr.log("[rspkr.HL.Restore.all]");var a=rspkr.HL.Restore.Storage,d=[],d=null,b=/sync_(word|sent)/gi;if(0<a.readId.length&&0<a.restoreContent.length){rspkr.c.dispatchEvent("onBeforeContentChange",window);for(var c=0;c<a.readId.length;c++)for(var f=0;f<a.readId[c].length;f++)d=
$rs.get("#"+a.readId[c][f]),!0===b.test(d.innerHTML)&&(rspkr.HL.Preserve.moveToShelter(d),d.innerHTML=a.restoreContent[c][f],rspkr.HL.Preserve.restoreFromShelter(d));rspkr.c.dispatchEvent("onAfterContentChange",window)}else if(0<a.readClass.length&&0<a.restoreContent.length){rspkr.c.dispatchEvent("onBeforeContentChange",window);for(c=0;c<a.readClass.length;c++){rspkr.HL.Preserve.clearShelter();d=$rs.get("."+a.readClass[c]);for(f=0;f<d.length;f++)!0===b.test(d[f].innerHTML)&&(rspkr.HL.Preserve.moveToShelter(d[f]),
d[f].innerHTML=a.restoreContent[c][f],rspkr.HL.Preserve.restoreFromShelter(d[f]))}rspkr.c.dispatchEvent("onAfterContentChange",window)}else rspkr.log("No stored content exists!",2)},checkContent:function(){rspkr.log("[rspkr.hl.Restore.checkContent]",1);!1===this.hasMarkup()&&(rspkr.hl.State.CURRENT==rspkr.hl.State.STOPPED&&rspkr.HL.Type.CURRENT==rspkr.HL.Type.SERVER_MARKUP)&&(this.clearRestoreContent(),this.setRestoreContent(),rspkr.pl.releaseAdapter(),rspkr.hl.State.setState(rspkr.hl.State.RELOAD))},
hasMarkup:function(){var a=rspkr.HL.Restore.Storage,d=[],d=null,c=/sync_(word|sent)/gi;if(0<a.readId.length&&0<a.restoreContent.length)for(var b=0;b<a.readId.length;b++)for(var f=0;f<a.readId[b].length;f++){if(d=$rs.get("#"+a.readId[b][f]),!0===c.test(d.innerHTML))return!0}else if(0<a.readClass.length&&0<a.restoreContent.length)for(b=0;b<a.readClass.length;b++){rspkr.HL.Preserve.clearShelter();d=$rs.get("."+a.readClass[b]);for(f=0;f<d.length;f++)if(!0===c.test(d[f].innerHTML))return!0}return!1},clearRestoreContent:function(){rspkr.log("[rspkr.HL.Restore.clearRestoreContent] Called!")},
setRestoreContent:function(){rspkr.log("[rspkr.HL.Restore.setRestoreContent] Called!");var a=rspkr.HL.Restore.Storage,c=[],b=[],e=/sync_(word|sent|user)/gi,f=a.restoreContent;0===a.readClass.length&&0===a.readId.length&&rspkr.HL.Restore.getReadData();if(0<a.readClass.length)for(var g=0;g<a.readClass.length;g++)c.push($rs.get("."+a.readClass[g]));else if(0<a.readId.length)for(g=0;g<a.readId.length;g++){for(var k=0;k<a.readId[g].length;k++)b.push($rs.get("#"+a.readId[g][k]));c.push(b);b=[]}else rspkr.log("ERR: Could not set restore content or find the read area data",
3);a.restoreContent=[];for(g=0;g<c.length;g++){for(k=0;k<c[g].length;k++)!1===e.test(c[g][k].innerHTML)?b.push(c[g][k].innerHTML):0<f.length?b.push(f[g][k]):b.push(c[g][k].innerHTML);a.restoreContent.push(b);b=[]}},getReadData:function(){rspkr.log("[rspkr.HL.Restore.getReadData]");for(var a=rspkr.HL.Restore.Storage,b=$rs.get("a"),c=0,e=b.length;c<e;c++)if(b[c].getAttribute("href")&&-1!==b[c].getAttribute("href").indexOf(rspkr.cfg.item("general.domain")+"/cgi-bin/"+rspkr.cfg.item("general.rsent"))&&
"rsSaveBtn"!==b[idx].id&&"rs_selimg"!==b[idx].id)if(-1!==b[c].getAttribute("href").search(/readclass=/)){var f=b[c].getAttribute("href").match(/readclass=[^&]+/gi)[0].replace("readclass=","");rspkr.HL.Restore.Storage.readClass.push(f)}else if(-1!==b[c].getAttribute("href").search(/readid=/)){for(var f=b[c].getAttribute("href").match(/readid=[^&]+/gi)[0].replace("readid=","").split(","),g=[],k=0;k<f.length;k++)g.push(f[k]);rspkr.HL.Restore.Storage.readId.push(g)}0===a.readClass.length&&0===a.readId.length&&
(rspkr.c.data.params.hasOwnProperty("readid")?a.readId.push([rspkr.c.data.params.readid]):rspkr.c.data.params.hasOwnProperty("readclass")&&a.readClass.push([rspkr.c.data.params.readclass]))}},Scroll:{currentSpan:null,timer:null,useScroll:!1,userScrollTimer:null,stopped:!0,getScrollY:function(){var a=0;"number"==typeof document.pageYOffset?a=document.pageYOffset:document.documentElement&&document.documentElement.scrollTop&&0<document.documentElement.scrollTop?a=document.documentElement.scrollTop:document.body&&
document.body.scrollTop&&(a=document.body.scrollTop);return a},getWindowHeight:function(){var a=0;"number"==typeof window.innerHeight?a=window.innerHeight:document.documentElement&&document.documentElement.clientHeight&&0<document.documentElement.clientHeight?a=document.documentElement.clientHeight:document.body&&document.body.clientHeight&&(a=document.body.clientHeight);return a+30},userScroll:function(){rspkr.HL.Scroll.timer&&(clearTimeout(rspkr.HL.Scroll.timer),rspkr.HL.Scroll.timer=null);rspkr.HL.Scroll.userScrollTimer&&
clearTimeout(rspkr.HL.Scroll.userScrollTimer);rspkr.HL.Scroll.userScrollTimer=setTimeout(function(){rspkr.HL.Scroll.userScrollTimer=null},5E3)},stopTimer:function(){rspkr.log("[rspkr.Hl.Scroll.stopTimer] Called!");rspkr.HL.Scroll.timer&&(clearTimeout(rspkr.HL.Scroll.timer),rspkr.HL.Scroll.timer=null);rspkr.HL.Scroll.stopped=!0},initScroll:function(){"scrollon"==rspkr.Common.Settings.get("hlscroll")?(rspkr.log("[rspkr.HL.Sroll.initScroll] Scroll initiated!"),rspkr.HL.Scroll.useScroll=!0,rspkr.evt("onUIClosePlayer",
rspkr.HL.Scroll.stopTimer),rspkr.evt("onUIStop",rspkr.HL.Scroll.stopTimer),rspkr.evt("onUIPause",rspkr.HL.Scroll.stopTimer),rspkr.evt("onUISliderMove",rspkr.HL.Scroll.userScroll),rspkr.evt("onFocusIn",rspkr.HL.Scroll.userScroll),rspkr.evt("onFocusOut",rspkr.HL.Scroll.userScroll),document.addEventListener?document.addEventListener("scroll",function(){setTimeout(function(){rspkr.HL.Scroll.userScroll()},0)},!1):document.attachEvent?document.attachEvent("onscroll",rspkr.HL.Scroll.userScroll):document.onscroll=
rspkr.HL.Scroll.userScroll):this.useScroll=!1},execScroll:function(a){this.useScroll&&(this.currentSpan=a,!0===this.stopped&&(this.stopped=!1),this.timer||(rspkr.log("[rspkr.hl.Scroll] execScroll"),this.timer=setTimeout(function(){rspkr.HL.Scroll.timer=null;rspkr.HL.Scroll.triggerScroll(rspkr.HL.Scroll.currentSpan)},500)))},triggerScroll:function(a){rspkr.log("[rspkr.HL.Scroll.triggerScroll] timer: "+rspkr.hl.Scroll.userScrollTimer+", stopped: "+rspkr.HL.Scroll.stopped);!rspkr.HL.Scroll.userScrollTimer&&
!1===rspkr.HL.Scroll.stopped&&rspkr.u.scroll.scrollToElm(a)}},State:{CURRENT:1,READY:1,STOPPED:2,PLAYING:3,RELOAD:4,setState:function(a){this.CURRENT=a;rspkr.log("[rspkr.hl.html5.States.setState] Changing state from "+this.CURRENT+" to "+a,1)}},sync:{init:function(){rspkr.c.dispatchEvent("onBeforeSyncInit",window);e.hlChanged=!1;if(0<rspkr.Common.data.selectedText.length||0<rspkr.Common.data.selectedHTML.length)rspkr.log("[rspkr.HL._sync.init] client markup"),rspkr.HL.Type.CURRENT=rspkr.HL.Type.CLIENT_MARKUP,
c.firstRun=1,"explorer"==b?document.selection.empty():c.preProcess.identifyElementsReplacementNode(document.body);else if(rspkr.log("[rspkr.HL._sync.init] server markup"),rspkr.HL.Type.CURRENT=rspkr.HL.Type.SERVER_MARKUP,"none"!=rspkr.Common.data.sync){var a=[],d=[],g=document.createElement("DIV");g.innerHTML=rspkr.HL.markedUpHTML;if(rspkr.c.data.params.hasOwnProperty("readclass"))d=$rs.findIn(g,"."+rspkr.c.data.params.readclass),a=$rs.get("."+rspkr.c.data.params.readclass);else if(rspkr.c.data.params.hasOwnProperty("readid"))for(var h=
rspkr.c.data.params.readid.split(","),f=0;f<h.length;f++){var p=$rs.findIn(g,"#"+h[f]);$rs.isArray(p)&&0===p.length?d.push(g):d.push(p);a.push($rs.get("#"+h[f]))}rspkr.log("[rspkr.HL.sync.init] readElements length: "+a.length);rspkr.c.dispatchEvent("onBeforeContentChange",window);for(f=0;f<a.length;f++)rspkr.HL.Preserve.moveToShelter(a[f]),a[f].innerHTML=d[f].innerHTML,rspkr.HL.Preserve.restoreFromShelter(a[f]);rspkr.c.dispatchEvent("onAfterContentChange",window);rspkr.HL.Preserve.clearShelter()}rspkr.HL.markedUpHTML=
"";rspkr.c.post.removeIframe();rspkr.c.dispatchEvent("onAfterSyncInit",window)},lightCleanUp:function(){rspkr.log("[rspkr.HL._sync.lightCleanUp] Called! "+rspkr.HL.Type.CURRENT);rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP&&!0===e.hlChanged?c.postProcess.settingsCleanUp():rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP&&!1===e.hlChanged||0<rspkr.Common.data.selectedText.length?c.postProcess.lightCleanUp():rspkr.HL.Type.CURRENT==rspkr.HL.Type.SERVER_MARKUP&&g.postProcess.lightCleanUp()},fullCleanUp:function(){rspkr.log("[rspkr.HL._sync.fullCleanUp] Called!");
rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP&&c.postProcess.lightCleanUp();g.postProcess.fullCleanUp()},setId:function(){rspkr.log("[rspkr.HL._sync.setId] Called!")},setContent:function(a){rspkr.log("[rspkr.HL._sync.setContent] Called!");rspkr.HL.markedUpHTML+=a},execute:function(a,b){var c=rspkr.Common.Settings;if(!("none"===c.get("hl")||"hloff"===c.get("hltoggle"))){if(rspkr.HL.Type.CURRENT==rspkr.HL.Type.SERVER_MARKUP){var e=$rs.hasClass($rs.get("#sync"+b),"sync_sent")?"sent":"word";if("sent"===
c.get("hl")&&"word"===e||"word"===c.get("hl")&&"sent"===e)return}rspkr.c.dispatchEvent("onBeforeSync",window);rspkr.HL.Type.CURRENT==rspkr.HL.Type.CLIENT_MARKUP?rspkr.HL.clientMarkup.sync(a,b):rspkr.HL.serverMarkup.sync(a,b);rspkr.c.dispatchEvent("onAfterSync",window)}}},settings:e,Type:{CURRENT:0,DEFAULT:0,SERVER_MARKUP:1,CLIENT_MARKUP:2}}}();rspkr.HL.engine||(rspkr.HL.engine={});
rspkr.HL.engine.explorer=function(){return{clientExtension:{firstRun:0,previousWord:{},previousSent:{},selectionRange:null,selectionHTML:null,selectedWordsRange:[],preProcess:{bookMarkIndex:1,endNode:null,endOffset:null,exludednodes:"table tr select option textarea ul ol dl thead tbody tfoot colgroup script map optgroup".split(" "),firstRun:0,inc:0,numberOfSelections:0,startNode:null,startOffset:null,init:function(){this.numberOfSelections++;rspkr.Common.data.selectedHTML=this.buildMarkup(rspkr.Common.data.selectedRange)},
buildMarkup:function(b){for(var c=rspkr.c.data.getParam("lang"),g=!1,e=null,a=rspkr.cfg.item("general.sentOnlyLang"),d=0;d<a.length;d++)if(c&&c.toLowerCase()===a[d]){g=!0;break}var c=b.duplicate(),d=0,a="",l=1,h=0,f=0,p="",k="";b.moveStart("word",-1);b.moveStart("word",1);c.isEqual(b)||b.moveStart("word",-1);c=b.duplicate();b.moveEnd("word",1);b.moveEnd("word",-1);c.isEqual(b)||b.moveEnd("word",1);rspkr.HL.clientMarkup.selectionRange=b.duplicate();var q=b.parentElement(),r=b.duplicate();r.collapse(!1);
c=b.duplicate();c.collapse();for(g&&(e=b.text.split(RegExp(decodeURIComponent("%e3%80%81")+"|"+decodeURIComponent("%e3%80%82")+"|\\s|\\n")));b.inRange(c)&&0!=b.compareEndPoints("EndToEnd",c);){f++;d++;if(1E4<d)break;g?(c=b.duplicate(),c.findText(e[f-1])):(c.collapse(!1),c.expand("word",1));k=p="";r.collapse(!1);var s=c.duplicate();s.collapse(!1);if(0==r.compareEndPoints("StartToStart",s)&&0==r.compareEndPoints("EndToEnd",s)&&s.htmlText==r.htmlText){h++;if(2>h)c.move("character",1);else if(4>h)c.move("character",
2);else if(6>h)c.move("word",1);else if(8>h)c.move("word",2);else if(10>h)c.move("sentence",1);else if(12>h)c.move("sentence",2);else break;c.collapse(!1)}else{h=0;if(-1===f)return c;rspkr.HL.clientMarkup.selectedWordsRange[f]=c.duplicate();r=c.text;s=c.htmlText;c.collapse(!1);var t;1===l?(lastPos=c.duplicate(),t=this.iterateParentTree(lastPos.parentElement(),document.body,q,0)):t=this.iterateParentTree(c.parentElement(),lastPos.parentElement(),q,0);for(var u=this.iterateParentTree(lastPos.parentElement(),
c.parentElement(),q,0),m=c.parentElement(),n=0;n<t&&20>n;n++)m.className.match("sync_")||(p=m.outerHTML.match("<[^>]*>")[0]+p),m=m.parentElement;m=lastPos.parentElement();for(n=0;n<u&&20>n;n++)m.className.match("sync_")||(k+="</"+m.tagName+">"),m=m.parentElement;if(0!=t||0!=u)lastPos=c.duplicate();1===l?(a+=p,l=0):a+=k+p;""!=s.replace("sync_sent_highlighted","")&&(a+="<"+rspkr.Common.data.browser.syncContainer+' class="sync_user" id="sync'+f+'">'+r+"</"+rspkr.Common.data.browser.syncContainer+">");
r=c.duplicate()}}a+="<\!-- f --\>";u=this.iterateParentTree(lastPos.parentElement(),document.body,q,0);m=lastPos.parentElement();for(n=0;n<u;n++)m.className.match("sync_")||(a+="</"+m.tagName+">"),m=m.parentElement;c.collapse();return a},iterateParentTree:function(b,c,g,e){for(var a=c;null!==a;){if(b==g||b==a)return e;a=a.parentElement}e++;return this.iterateParentTree(b.parentElement,c,g,e)}},postProcess:{lightCleanUp:function(){rspkr.log("[clientMarkup.postProcess.lightCleanUp] called!");for(var b=
document.getElementsByTagName(rspkr.Common.data.browser.syncContainer),c=b.length-1;-1<c;c--)b[c].className=b[c].className.replace("sync_sent_highlighted","sync_sent"),b[c].className=b[c].className.replace("sync_word_highlighted","sync_word"),-1===b[c].className.toLowerCase().indexOf("sync_user")&&b[c].removeAttribute("id");var b=rspkr.HL.clientMarkup.previousWord.range,g=rspkr.HL.clientMarkup.previousWord.forecolor,e=rspkr.HL.clientMarkup.previousWord.backcolor,a=rspkr.HL.clientMarkup.previousSent.range,
d=rspkr.HL.clientMarkup.previousSent.forecolor,l=rspkr.HL.clientMarkup.previousSent.backcolor;if(0<b.length)for(var c=0,h=b.length;c<h;c++)e[c]&&(b[c].execCommand("backcolor",0,e[c]),g[c]&&b[c]&&b[c].execCommand("forecolor",0,g[c]));if(0<a.length){c=0;for(h=a.length;c<h;c++)l[c]&&(a[c].execCommand("backcolor",0,l[c]),d[c]&&a[c]&&a[c].execCommand("forecolor",0,d[c]))}rspkr.hl.clientMarkup.lastWord=null},settingsCleanUp:function(){this.lightCleanUp()},fullCleanUp:function(){rspkr.log("[ClientMarkup.postProcess.fullCleanUp] called!");
this.lightCleanUp();rspkr.hl.clientMarkup.selectedWordsRange=[];rspkr.hl.clientMarkup.selectionRange=null;rspkr.hl.clientMarkup.lastWord=null}},sync:function(b,c){var g=!1,e;0===(b&2)&&(g=0!=(b&1)?!0:!1);1===this.firstRun&&(this.previousWord.range=[],this.previousWord.backcolor=[],this.previousWord.forecolor=[],this.previousSent.range=[],this.previousSent.backcolor=[],this.previousSent.forecolor=[]);e=this.selectedWordsRange[c];if(1===this.firstRun){this.firstRun=0;if(0<this.previousSent.range.length){for(var a=
0;a<this.previousSent.range.length;a++)this.previousSent.range[a].execCommand("backcolor",0,this.previousSent.backcolor[a]),null!==this.previousSent.forecolor[a]&&this.previousSent.range[a].execCommand("forecolor",0,this.previousSent.forecolor[a]);this.previousSent.range=[];this.previousSent.backcolor=[];this.previousSent.forecolor=[]}rspkr.HL.clientMarkup.selectionRange&&"wordsent"===rspkr.st.get("hl")&&(this.previousSent.range.push(rspkr.HL.clientMarkup.selectionRange),this.previousSent.backcolor.push(rspkr.HL.clientMarkup.selectionRange.queryCommandValue("backcolor")),
this.previousSent.forecolor.push(rspkr.HL.clientMarkup.selectionRange.queryCommandValue("forecolor")),this.selectionRange.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")),this.selectionRange.execCommand("forecolor",0,rspkr.cfg.item("settings.hltext")))}if(!g&&0<this.previousWord.range.length){for(a=0;a<this.previousWord.range.length;a++)"word"==rspkr.st.get("hl")||"sent"==rspkr.st.get("hl")?this.previousWord.range[a].execCommand("backcolor",0,this.previousWord.backcolor[a]):this.previousWord.range[a].execCommand("backcolor",
0,rspkr.Common.Settings.get("hlsent")),this.previousWord.range[a].execCommand("forecolor",0,this.previousWord.forecolor[a]);this.previousWord.range=[];this.previousWord.backcolor=[];this.previousWord.forecolor=[]}this.previousWord.backcolor.push(e.queryCommandValue("backcolor"));this.previousWord.forecolor.push(e.queryCommandValue("forecolor"));this.previousWord.range.push(e);"sent"==rspkr.st.get("hl")?e.execCommand("backcolor",0,rspkr.Common.Settings.get("hlsent")):e.execCommand("backcolor",0,rspkr.Common.Settings.get("hlword"));
this.lastWord=e;e.execCommand("forecolor",0,rspkr.cfg.item("settings.hltext"))}}}}();
rspkr.HL.engine.gecko=function(){return{clientExtension:{test:"test",preProcess:{bookMarkIndex:1,endNode:null,endOffset:null,exludednodes:"table tr select option textarea ul ol dl thead tbody tfoot colgroup script map optgroup".split(" "),firstRun:0,inc:0,numberOfSelections:0,startNode:null,startOffset:null,init:function(){this.numberOfSelections++;var b="",b=rspkr.Common.data.selectedRange;this.startNode=b.startContainer;this.endNode=b.endContainer;this.startOffset=this.modifyOffsetStartOfWord(this.startNode,
b.startOffset);this.endOffset=this.modifyOffsetEndOfWord(this.endNode,b.endOffset);b=this.buildMarkup(b.commonAncestorContainer);window.getSelection().removeAllRanges();rspkr.Common.data.selectedHTML=b},buildMarkup:function(b){this.firstRun=1;var c="",g=this.inc;if(3==b.nodeType)c+=this.textMarkup(b);else{var e,a="";if(b.hasChildNodes())for(e=0;e<b.childNodes.length;e++){var d=b.childNodes.item(e);d==this.startNode&&(this.inc=1);b==this.startNode&&e==this.startOffset&&(this.inc=1);8!=d.nodeType&&
(a+=this.buildMarkup(d));if(b==this.endNode&&e==this.endOffset){this.inc=0;break}if(d==this.endNode){this.inc=0;break}}(g||this.inc)&&(!b.className||b.className.replace("sync")===b.className&&b.id.replace("sync")===b.id)?(g=document.createElement("div"),g.appendChild(b.cloneNode(!0)),tempdivtag=g.innerHTML.match("<[^>]*>"),null!==tempdivtag&&0<tempdivtag.length?(c+=tempdivtag[0],c=c+a+("</"+b.nodeName+">")):c+=a):c+=a;if(b.hasChildNodes())for(e=0;e<b.childNodes.length;e++){if(b===this.endNode&&e===
this.endOffset){this.inc=0;break}if(d===this.endNode){this.inc=0;break}}}return c},textMarkup:function(b){var c=!0,g="",e,a="",d="",l=b.nodeValue;b===this.startNode&&-1!==this.startOffset&&b===this.endNode&&-1!==this.endOffset?(a=b.nodeValue.substring(0,this.startOffset),l=b.nodeValue.substring(this.startOffset,this.endOffset),d=b.nodeValue.substring(this.endOffset),this.inc=1):b===this.startNode&&-1!==this.startOffset?(a=b.nodeValue.substring(0,this.startOffset),l=b.nodeValue.substring(this.startOffset),
this.inc=1):b===this.endNode&&-1!==this.endOffset&&(l=b.nodeValue.substring(0,this.endOffset),d=b.nodeValue.substring(this.endOffset),this.inc=1);if(!this.inc)return"";for(e=0;e<this.exludednodes.length;e++)if(b.parentNode&&b.parentNode.nodeName.toLowerCase()===this.exludednodes[e]){c=!1;g=this.htmlencode(l);break}c&&(g=this.markupSentences(this.htmlencode(l),null));b===this.endNode&&-1!==this.endOffset&&(this.inc=0);c&&(null!==b.parentNode&&""!==l)&&(c=this.createreplacementnode(a+g+d,getComputedStyle(b.parentNode,
null)),b.parentNode.insertBefore(c,b),b.parentNode.removeChild(b));return g},markupSentences:function(b){b=this.splitString(b,[", ",". ","! ","? ",decodeURIComponent("%e3%80%81"),decodeURIComponent("%e3%80%82")]);if(!b)return"";for(var c="",g=0;g<b.length;g++)c+="<"+rspkr.Common.data.browser.syncContainer+' class="ffsent'+this.numberOfSelections+" cj"+this.numberOfSelections+'" ',c+='id="sync'+this.bookMarkIndex++ +'">',c+=this.markupWords(b[g]),c+="</"+rspkr.Common.data.browser.syncContainer+">";
return c},markupWords:function(b){b=this.splitString(b," ");if(!b)return"";for(var c="",g=0;g<b.length;g++)c+="<"+rspkr.Common.data.browser.syncContainer+' class="sync_user sync_word ck'+this.numberOfSelections+'"',c+=' id="sync'+this.bookMarkIndex++ +'">',c+=b[g],c+="</"+rspkr.Common.data.browser.syncContainer+">";return c},trim:function(b){return b.replace(/^\s+|\s+$/g,"")},htmlencode:function(b){var c=document.createElement("div"),b=document.createTextNode(b);c.appendChild(b);return c.innerHTML},
identifyElementsReplacementNode:function(b){b.tagName&&(b.tagName.toLowerCase()==rspkr.Common.data.browser.syncContainer&&b.id)&&(rspkr.HL.clientMarkup.selectedWordsRange[b.id]=b);if(b.hasChildNodes())for(var c=0;c<b.childNodes.length;c++){var g=b.childNodes.item(c);this.identifyElementsReplacementNode(g)}},createreplacementnode:function(b){var c=document.createElement(rspkr.Common.data.browser.syncContainer);c.innerHTML=b;c.setAttribute("class","synctemp cl"+this.numberOfSelections);return c},modifyOffsetStartOfWord:function(b,
c){for(var g=[" ",", ",". ","! ","? ",decodeURIComponent("%e3%80%81"),decodeURIComponent("%e3%80%82")];b.nodeValue&&0!=c;){for(var e=0;e<g.length;e++)if(breakstr=g[e],0==b.nodeValue.substring(c-1).indexOf(breakstr))return c;c--}return c},modifyOffsetEndOfWord:function(b,c){for(var g=[" ",", ",". ","! ","? ",decodeURIComponent("%e3%80%81"),decodeURIComponent("%e3%80%82")];b.nodeValue&&c!=b.nodeValue.length;){for(var e=0;e<g.length;e++)if(breakstr=g[e],0==b.nodeValue.substring(c-1).indexOf(breakstr))return c;
c++}return c},returnClassArraySubstring:function(b){var c=document.getElementsByTagName("*"),g=0,e=[];for(i=0;i<c.length;i++)c[i].className.replace(b,"")!=c[i].className&&(e[g]=c[i],g++);return e},splitString:function(b,c){for(var g=[""],e=0,a=0;a<b.length;a++){for(var d=0;d<c.length;d++){for(var l=c[d],h=!0,f=0;f<l.length;f++)if(0>b.length-(a+f)||l[l.length-f-1]!=b[a-f-1]){h=!1;break}h&&(e++,g[e]="")}g[e]+=b[a]}return g}},postProcess:{cleanUpSpans:function(){rspkr.log("[ClientMarkup.postProcess.cleanUpSpans] called!");
var b=document.getElementsByTagName(rspkr.Common.data.browser.syncContainer),c;for(i=b.length-1;-1<i;i--){c=document.createDocumentFragment();for(j=0;j<b[i].childNodes.length;j++)c.appendChild(b[i].childNodes[j].cloneNode(!0));b[i].parentNode.replaceChild(c,b[i])}},lightCleanUp:function(){rspkr.log("[ClientMarkup.postProcess.lightCleanUp] called!!");var b=document.getElementsByTagName(rspkr.Common.data.browser.syncContainer);for(i=b.length-1;-1<i;i--)b[i].className=b[i].className.replace("sync_sent_highlighted",
"sync_sent"),b[i].className=b[i].className.replace("sync_word_highlighted","sync_word"),-1===b[i].className.toLowerCase().indexOf("sync_user")&&b[i].removeAttribute("id")},settingsCleanUp:function(){rspkr.log("[ClientMarkup.postProcess.settingsCleanUp] called!");var b=rspkr.HL.clientMarkup.previousWord.element,c=rspkr.HL.clientMarkup.previousWord.className,g=rspkr.HL.clientMarkup.previousSent.element,e=rspkr.HL.clientMarkup.previousSent.className;if(0<b.length){for(var a in b)b[a].className=c[a];
rspkr.HL.clientMarkup.previousWord.element=[];rspkr.HL.clientMarkup.previousWord.className=[]}if(0<g.length){for(a in g)g[a].className=e[a];rspkr.HL.clientMarkup.previousSent.element=[];rspkr.HL.clientMarkup.previousSent.className=[]}},fullCleanUp:function(){rspkr.log("[ClientMarkup.postProcess.fullCleanUp] called!");var b=rspkr.HL.clientMarkup.previousWord.element,c=rspkr.HL.clientMarkup.previousWord.className,g=rspkr.HL.clientMarkup.previousSent.element,e=rspkr.HL.clientMarkup.previousSent.className;
if(0<b.length){for(var a in b)b[a].className=c[a];rspkr.HL.clientMarkup.previousWord.element=[];rspkr.HL.clientMarkup.previousWord.className=[]}if(0<g.length){for(a in g)g[a].className=e[a];rspkr.HL.clientMarkup.previousSent.element=[];rspkr.HL.clientMarkup.previousSent.className=[]}rspkr.Common.data.selectedHTML=""}},sync:function(b,c){rspkr.log("clientSync "+rspkr.HL.clientMarkup.selectedWordsRange.length);var g=!1,e;0==(b&2)&&(g=0!=(b&1)?!0:!1);1==this.firstRun&&(this.previousWord.element=[],this.previousWord.className=
[],this.previousSent.element=[],this.previousSent.className=[]);e=this.selectedWordsRange["sync"+c];rspkr.log(e.className);if(e.className.replace("word","")!=e.className){rspkr.log("inside");if(0<this.previousWord.element.length&&0<this.previousWord.className.length&&!g){for(g=0;g<this.previousWord.element.length;g++)this.previousWord.element[g].className=this.previousWord.className[g];this.previousWord.element=[];this.previousWord.className=[]}this.previousWord.element.push(e);this.previousWord.className.push(e.className);
e.className="sent"===rspkr.st.get("hl")?"sync_user sync_sent_highlighted":"sync_user sync_word_highlighted"}e&&rspkr.HL.Scroll.execScroll(e);if(1==this.firstRun){this.firstRun=0;if(0<this.previousSent.element.length){for(g=0;g<this.previousSent.element.length;g++)this.previousSent.element[g].className=this.previousSent.className[g];this.previousSent.element=[];this.previousSent.className=[]}if("wordsent"==rspkr.st.get("hl")){e=this.preProcess.returnClassArraySubstring("ffsent"+this.preProcess.numberOfSelections+
" ");for(g=0;g<e.length;g++)this.previousSent.element[g]=e[g],this.previousSent.className[g]=e[g].className,e[g].className="ffsent"+this.preProcess.numberOfSelections+" sync_sent_highlighted"}}}}}}();
